$(window).scroll((function(e){$(".navbar")[$(window).scrollTop()>=150?"addClass":"removeClass"]("navbar-hide")}));let mymap=L.map("mapid").locate({setView:!0});L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(mymap);let control=L.Routing.control({routeWhileDragging:!1,draggableWaypoints:!1,geocoder:L.Control.Geocoder.bing("Amet3CuxhPoE-ATl8on8j9I-1cs-6vkJASpFkDPZCXuqOJ0e4UH3ExO5LSqLC4e2"),router:L.Routing.graphHopper("b4602847-f10d-46d9-bc14-6774bef56b9a",{urlParameters:{vehicle:"foot",details:"edge_id",debug:!0}})}).addTo(mymap);control.once("waypointschanged",(function(e){var t=control.getWaypoints(),n=t[0].latLng.lat,a=t[0].latLng.lng;mymap.panTo([n,a],8)}));let count=0;mymap.on("click",(function(e){1==count||count%2!=0?(control.spliceWaypoints(control.getWaypoints().length-1,1,e.latlng),count++,control.route()):(control.spliceWaypoints(0,1,e.latlng),count++,control.route())})),control.on("routesfound",(async function(e){var t=new Array;for(t=control.getWaypoints(),document.getElementById("location").innerHTML="",p=0;p<t.length;p++){const e=t[p].latLng.lat,a=t[p].latLng.lng;let o=t[p].name;const r=await fetch(`/weather/${e},${a}`),l=await r.json();if(console.log(l),void 0===l.minutely)var n=JSON.stringify(l.currently.summary).replace(/"/g,"");else n=JSON.stringify(l.minutely.summary).replace(/"/g,"");0===p?document.getElementById("location").innerHTML+="<strong>Start point:</strong> "+o+"<br>":p===t.length-1?document.getElementById("location").innerHTML+="<strong>End point:</strong> "+o+"<br> ":document.getElementById("location").innerHTML+="<strong>Mid point:</strong> "+o+"<br>",document.getElementById("location").innerHTML+=n+"<br><br>"}document.getElementById("breakinfo0").style.display="inline",$("#location").fadeIn();var a=new Array;a=e.routes[0].coordinates;var o=Math.floor(e.routes[0].summary.totalTime),r=e.routes[0].summary.totalDistance,l=r/o,i=new Array,s=new Array;for(Y=.1;Y<Math.floor((a.length-1)*Y)&&Y<1;Y+=.1){{var c=Math.floor((a.length-1)*Y),m=a[c].lat,d=a[c].lng,u=Math.floor(r*Y),y=Math.floor(u/l/60);s.push(y),console.log(`${y} minutes to reach ${u} meters which is ${(100*Y).toFixed(0)}% of the route`);const e=await fetch(`/weather/${m},${d}`);var g=await e.json();i.push(g)}console.log(i),console.log(s);for(var p=0;p<=i.length-1;p++){var h=new Array,f=new Array,b=i[p].currently.temperature;h.push(b);var w=i[p].currently.apparentTemperature;if(f.push(w),void 0===i[0].alerts)var I="none";else I=i[0].alerts[0].title}var T=h.reduce((e,t)=>e+t)/h.length,v=f.reduce((e,t)=>e+t)/f.length,B=i[0].currently.summary,L=i[0].currently.icon;function E(e){return"clear-day"==e?'<i class="wi wi-day-sunny display-2"></i>':"clear-night"==e?'<i class="wi wi-night-clear display-2"></i>':"rain"==e?'<i class="wi wi-rain display-2"></i>':"snow"==e?'<i class="wi wi-snow display-2"></i>':"sleet"==e?'<i class="wi wi-sleet display-2"></i>':"wind"==e?'<i class="wi wi-strong-wind display-2"></i>':"fog"==e?'<i class="wi wi-fog display-2"></i>':"cloudy"==e?'<i class="wi wi-cloudy display-2"></i>':"partly-cloudy-day"==e?'<i class="wi wi-day-cloudy display-2"></i>':"partly-cloudy-night"==e?'<i class=" wi wi-night-alt-cloudy display-2"></i>':void 0}console.log(L),document.getElementById("routesummary").innerHTML="",document.getElementById("routesummarylabel").innerHTML="",document.getElementById("routesummarylabel").innerHTML+="Route Summary:<br>",document.getElementById("routesummary").innerHTML+=`Travelling by: ${control.getRouter().options.urlParameters.vehicle} <br>`,document.getElementById("routesummary").innerHTML+=`Distance: ${Math.floor(r)} meters <br>`,document.getElementById("routesummary").innerHTML+=`Duration of Journey: ${Math.floor(o/60)} minutes <br>`,$("#routesummarylabel").fadeIn(),$("#routesummary").fadeIn(),document.getElementById("breakinfo1").style.display="inline",document.getElementById("weathersummarylabel").innerHTML="",document.getElementById("weathersummary").innerHTML="",document.getElementById("weathersummarylabel").innerHTML+="Weather Summary:<br>",document.getElementById("weathersummary").innerHTML+=` ${E(L)}  ${B} <br> <br>`,document.getElementById("weathersummary").innerHTML+="none"==I?"Alerts: None <br>":`Alerts: ${I} <br>`;var M,x="&#8457";for("us"==i[0].flags.units?(document.getElementById("weathersummary").innerHTML+=`Average Temperature of Journey: ${T} ${x} <br>`,document.getElementById("weathersummary").innerHTML+=`Average Apparent Temperature of Journey: ${v} ${x} <br>`):(document.getElementById("weathersummary").innerHTML+=`Average Temperature of Journey: ${T} &#8451 <br>`,document.getElementById("weathersummary").innerHTML+=`Average Apparent Temperature of Journey: ${v} &#8451 <br>`),$("#weathersummarylabel").fadeIn(),$("#weathersummary").fadeIn(),document.getElementById("breakinfo2").style.display="inline",M=0;M<=6;M++){var H=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),A=(new Date).getDay();document.getElementById("cardday".concat(M)).innerHTML=H[(A+M)%7],document.getElementById("cardsummary".concat(M)).innerHTML=i[0].daily.data[M].summary;var k=i[0].daily.data[M].icon;document.getElementById("cardtemp".concat(M)).innerHTML=`${E(k)} ${Math.round(i[0].daily.data[M].apparentTemperatureHigh)}&deg; `,document.getElementById("cardprecip".concat(M)).innerHTML=Math.round(100*i[0].daily.data[M].precipProbability)+"%",document.getElementById("cardwind".concat(M)).innerHTML=Math.floor(i[0].daily.data[M].windSpeed)+" km/h ",document.getElementById("card".concat(M)).style.display="inline",$("card".concat(M)).fadeIn()}document.getElementById("breakinfo6").style.display="inline"}function C(e){let t=new Array;for(var n=0;n<=i.length-1;n++){var a=s[n],o=i[n].minutely.data[a+e].precipIntensity/60,r=i[n].minutely.data[a+e].precipProbability*o;t.push(r)}return t}console.log(Math.floor(o/60));var S=new Array;S.push(C(0)),console.log(S);var P=Math.floor(60-o/60);console.log(P),document.getElementById("timechartlabel").innerHTML="Expected rain intensity along your route:",$("#timechartlabel").fadeIn();var R=new Chartist.Line("#timechart",{labels:s,series:S},{chartPadding:{top:20,right:0,bottom:30,left:40},plugins:[Chartist.plugins.ctAxisTitle({axisX:{axisTitle:"Minutes into the route",axisClass:"ct-axis-title",offset:{x:0,y:50},textAnchor:"middle"},axisY:{axisTitle:"Millimeters per minute",axisClass:"ct-axis-title",offset:{x:0,y:-2},textAnchor:"middle",flipTitle:!1,high:1,low:0}})]});$("#timechart").fadeIn(),document.getElementById("minlabel").textContent="Leave in: ",document.getElementById("breakinfo3").style.display="inline",document.getElementById("minutes").style.display="inline",document.getElementById("minutes").options.length=0;var J=document.getElementById("minutes");for(p=0;p<=P;p++){var W=document.createElement("option");W.textContent=0==p?"Now":1==p?p+" Minute":p+" Minutes",W.value=p,J.appendChild(W)}var N=[];for(p=0;p<s.length-1;p++)N[p]=s[p+1]-s[p];console.log(N);var D=[],j=[],Y=0,O=[],F=[];for(p=0;p<=P;p++)D.push(C(p));for(p=0;p<=P-1;p++)O.push(p);console.log(D);for(p=0;p<D.length-1;p++)for(Y=0;Y<D[p].length-1;Y++)j[p]=N[Y]*D[p][Y];console.log(j),$("#minutes").on("change",(function(){var e=$("#minutes").val(),t=parseInt(e,10),n=new Array;n.push(C(t)),R.update({labels:s,series:n})})),F.push(j),console.log(F),document.getElementById("sumchartlabel").innerHTML="Total amount of rainfall for all possible departure times:",$("#sumchartlabel").fadeIn();new Chartist.Line("#sumchart",{labels:O,series:F},{chartPadding:{top:20,right:0,bottom:30,left:40},plugins:[Chartist.plugins.ctAxisTitle({axisX:{axisTitle:"Possible departure times in minutes",axisClass:"ct-axis-title",offset:{x:0,y:50},textAnchor:"middle"},axisY:{axisTitle:"Millimeters per minute",axisClass:"ct-axis-title",offset:{x:0,y:-2},textAnchor:"middle",flipTitle:!1,high:1,low:0}})]});$("#sumchart").fadeIn();var X=(A=new Date).getHours()+":"+A.getMinutes();console.log("The current time is "+X),I.includes("none")||"foot"!=control.getRouter().options.urlParameters.vehicle&&"bike"!=control.getRouter().options.urlParameters.vehicle||(document.getElementById("alerts").style.display="inline",document.getElementById("alerts").innerHTML=`<i class='fas fa-exclamation-triangle'></i>  An Alert (${I}) has been issued. You are advised not to travel long journeys by foot or bike until the alert is cleared off.`);let q=Math.min(...j),U=j.indexOf(Math.min(...j));document.getElementById("breakinfo5").style.display="inline",q>0?(document.getElementById("besttime").style.display="inline",document.getElementById("besttime").innerHTML=`<i class='fas fa-cloud-rain'></i>  The best time to leave is in ${U} minutes but you might experience some rain along your way, be sure to dress properly!`):(document.getElementById("besttime").style.display="inline",document.getElementById("besttime").innerHTML=`<i class="fa fa-check"></i>  The best time to leave is in ${U} minutes. It doesn't look that it is going to rain for that time!`),async function(){const e=await fetch(`/past/${t[0].latLng.lat},${t[0].latLng.lng}`),n=await e.json();n.currently.precipIntensity>0&&n.currently.precipProbability>=.5&&(document.getElementById("puddles").style.display="inline",document.getElementById("puddles").innerHTML="<i class='fas fa-exclamation'></i>  It has recently rained, please watch out for muddy tracks or puddles.")}(),control.getRouter().options.urlParameters.avoid="track",document.getElementById("breakinfo4").style.display="inline";var V=document.getElementById("emailtext");document.body.appendChild(V);var Z=document.getElementById("emailbtn");Z.innerHTML="Send",document.body.appendChild(Z),document.getElementById("emailbtn").style.display="inline",document.getElementById("emailtext").style.display="inline",document.getElementById("emaillabel").innerHTML="Do you want an e-mail reminder? Input your e-mail below and click 'Send'",document.getElementById("emaillabel").style.display="inline",Z.onclick=async function(){const e=await fetch(`/email/${V.value}~${t[0].name}~${t[1].name}~${U}~${v}~${B}~${Math.floor(o/60)}~${control.getRouter().options.urlParameters.vehicle}`),n=await e.json();console.log(n),console.log(V.value);var a=document.getElementById("emailsuccess");a.innerHTML=n,a.innerHTML.includes("error")?a.style.color="red":a.style.color="green"}})),L.easyButton("fas fa-walking",(function(e,t){control.getRouter().options.urlParameters.vehicle="foot",control.route()})).addTo(mymap),L.easyButton("fas fa-bicycle",(function(e,t){control.getRouter().options.urlParameters.vehicle="bike",control.route()})).addTo(mymap),L.easyButton("fas fa-car",(function(e,t){control.getRouter().options.urlParameters.vehicle="car",control.route()})).addTo(mymap),L.easyButton("fas fa-search-location",(function(e,t){t.locate({setView:!0}).on("locationfound",(function(e){var n=L.marker(e.latlng);console.log(e.latlng),control.spliceWaypoints(0,1,e.latlng),document.getElementsByClassName("leaflet-routing-remove-waypoint")[0].addEventListener("click",(function(e){t.removeLayer(n),t.removeLayer(n),control.route()}))})).on("locationerror",(function(e){console.log(e),alert("Location access denied.")})),control.route()})).addTo(mymap);let hideUnhide=L.easyButton({states:[{stateName:"Hide",icon:"far fa-eye-slash",title:"Hide the toolbar",onClick:function(e,t){control.hide(),e.state("Show")}},{stateName:"Show",icon:"far fa-eye",title:"Show the toolbar",onClick:function(e,t){control.show(),e.state("Hide")}}]});hideUnhide.addTo(mymap);